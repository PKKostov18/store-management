<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Детайли за магазин</title>
  <link rel="stylesheet" th:href="@{/css/store-details.css}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-4">
  <h1 class="store-title" th:text="${store.name}">Store Name</h1>

  <!-- Действия – Преместени най-отгоре -->
  <div class="mb-4 d-flex gap-2 justify-content-center">
    <a class="btn btn-outline-secondary" th:href="@{'/store/' + ${store.id} + '/info'}">ℹ Информация за магазина</a>
    <a class="btn btn-success" th:href="@{'/store/' + ${store.id} + '/products/add'}">➕ Добави продукт</a>
    <a class="btn btn-primary" th:href="@{'/store/' + ${store.id} + '/cashiers/add'}">➕ Добави касиер</a>
  </div>

  <!-- Касови апарати -->
  <section>
    <h2>Касови апарати</h2>
    <div class="register-container d-flex flex-wrap gap-3">
      <div th:each="register, iterStat : ${store.cashRegisters}"
           class="register-card p-3 border rounded"
           th:classappend="${register.cashier != null} ? ' bg-success text-white' : ' bg-danger text-white'">

        <p th:text="'Апарат №' + ${iterStat.index + 1}"></p>

        <div th:if="${register.cashier != null}">
          <p th:text="'Касиер: ' + ${register.cashier.name}"></p>
        </div>

        <div th:unless="${register.cashier != null}">
          <button type="button"
                  class="btn btn-light"
                  data-bs-toggle="modal"
                  data-bs-target="#assignCashierModal"
                  th:attr="data-register-id=${register.id},
                 data-cashiers-available=${#lists.isEmpty(availableCashiers) ? 'false' : 'true'}">
            Без касиер – Назначи
          </button>
          <p class="text-warning mt-2 no-cashiers-message d-none">Няма свободни касиери.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Продукти -->
  <section class="mt-5">
    <h2>Продукти в магазина</h2>
    <div class="table-wrapper">
      <table class="table table-bordered">
        <thead>
        <tr>
          <th>Име</th>
          <th>Категория</th>
          <th>Количество</th>
          <th>Цена на доставка</th>
          <th>Срок на годност</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${products}">
          <td th:text="${product.name}"></td>
          <td th:text="${product.category}"></td>
          <td th:text="${product.quantity}"></td>
          <td th:text="${product.deliveryPrice} + ' лв.'"></td>
          <td>
            <span th:if="${product.hasExpirationDate}" th:text="${#temporals.format(product.expirationDate, 'dd.MM.yyyy')}"></span>
            <span th:unless="${product.hasExpirationDate}">-</span>
          </td>
        </tr>
        <tr th:if="${products.empty}">
          <td colspan="5">Няма добавени продукти</td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Касиери -->
  <section class="mt-5">
    <h2>Касиери</h2>
    <div class="table-wrapper">
      <table class="table table-bordered">
        <thead>
        <tr>
          <th>Име</th>
          <th>Месечна заплата</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cashier : ${store.cashiers}">
          <td th:text="${cashier.name}"></td>
          <td th:text="${cashier.monthlySalary} + ' лв.'"></td>
        </tr>
        <tr th:if="${store.cashiers.empty}">
          <td colspan="2">Няма добавени касиери</td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Линк за връщане -->
  <div class="back-link mt-4">
    <a th:href="@{/store/list}">⬅ Обратно към списъка</a>
  </div>
</div>

<!-- MODAL за назначаване на касиер -->
<div class="modal fade" id="assignCashierModal" tabindex="-1" aria-labelledby="assignCashierModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="post" id="assignCashierForm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="assignCashierModalLabel">Сложи касиер на каса</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Затвори"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="cashRegisterId" id="cashRegisterId" />
          <div class="mb-3">
            <select class="form-select" name="cashierId" id="cashierId" required>
              <option value="" disabled selected hidden>Избери касиер</option>
              <option th:each="cashier : ${availableCashiers}"
                      th:value="${cashier.id}"
                      th:text="${cashier.name}"></option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Запази</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/store-details.js"></script>
</body>
</html>
